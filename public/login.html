<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
    <title>Login - APNA Card</title>
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Stylesheets -->
    <link rel="stylesheet" href="/css/style.css">

    <!-- App Icons & Manifest -->
    <link rel="icon" href="/favicon.svg" type="image/svg+xml">
    <link rel="manifest" href="/site.webmanifest">
    <meta name="application-name" content="APNA Card">
    <meta name="apple-mobile-web-app-title" content="APNA Card">

    <!-- SEO -->
    <meta name="description" content="Sign in to APNA Card to manage your UET Lahore student ID card.">
    <link rel="canonical" href="https://apnacard.netlify.app/login">
    <meta name="robots" content="noindex, nofollow">
    <meta name="theme-color" content="#0e3e98">
    <meta property="og:title" content="Login — APNA Card">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://yourdomain.com/login">
    <meta name="twitter:card" content="summary">
    
</head>
<body class="auth-page">
    <a href="/" class="back-home">
        <svg class="icon" viewBox="0 0 24 24">
            <path fill="currentColor" d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z"/>
        </svg>
        Back to Home
    </a>

    <div class="login-container">
    <script src="/js/footer.js" defer></script>
        <div class="login-header">
            <div style="display: flex; align-items: center; justify-content: center; margin-bottom: 1rem;">
                <svg class="icon-lg" style="margin-right: 0.5rem;" viewBox="0 0 24 24" fill="white">
                    <path d="M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M7.07,18.28C7.5,17.38 10.12,16.5 12,16.5C13.88,16.5 16.5,17.38 16.93,18.28C15.57,19.36 13.86,20 12,20C10.14,20 8.43,19.36 7.07,18.28M18.36,16.83C16.93,15.09 13.46,14.5 12,14.5C10.54,14.5 7.07,15.09 5.64,16.83C4.62,15.5 4,13.82 4,12C4,7.59 7.59,4 12,4C16.41,4 20,7.59 20,12C20,13.82 19.38,15.5 18.36,16.83M12,6C10.06,6 8.5,7.56 8.5,9.5C8.5,11.44 10.06,13 12,13C13.94,13 15.5,11.44 15.5,9.5C15.5,7.56 13.94,6 12,6M12,11A1.5,1.5 0 0,1 10.5,9.5A1.5,1.5 0 0,1 12,8A1.5,1.5 0 0,1 13.5,9.5A1.5,1.5 0 0,1 12,11Z"/>
                </svg>
                APNA Card
            </div>
            <h1>Welcome Back</h1>
            <p>Sign in to your account</p>
        </div>

        <div class="login-body">
            <div id="alert-container"></div>
            
            <form id="loginForm">
                <div class="form-group">
                    <label class="form-label" for="email">Email Address</label>
                    <div style="position: relative;">
                        <svg class="icon form-icon" viewBox="0 0 24 24">
                            <path fill="currentColor" d="M20,8L12,13L4,8V6L12,11L20,6M20,4H4C2.89,4 2,4.89 2,6V18A2,2 0 0,0 4,20H20A2,2 0 0,0 22,18V6C22,4.89 21.1,4 20,4Z"/>
                        </svg>
                        <input 
                            type="email" 
                            id="email" 
                            name="email" 
                            class="form-control" 
                            placeholder="Enter your email"
                            required
                        >
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label" for="password">Password</label>
                    <div style="position: relative;">
                        <svg class="icon form-icon" viewBox="0 0 24 24">
                            <path fill="currentColor" d="M12,17A2,2 0 0,0 14,15C14,13.89 13.1,13 12,13A2,2 0 0,0 10,15A2,2 0 0,0 12,17M18,8A2,2 0 0,1 20,10V20A2,2 0 0,1 18,22H6A2,2 0 0,1 4,20V10C4,8.89 4.9,8 6,8H7V6A5,5 0 0,1 12,1A5,5 0 0,1 17,6V8H18M12,3A3,3 0 0,0 9,6V8H15V6A3,3 0 0,0 12,3Z"/>
                        </svg>
                        <input 
                            type="password" 
                            id="password" 
                            name="password" 
                            class="form-control" 
                            placeholder="Enter your password"
                            required
                        >
                    </div>
                </div>

                <button type="submit" class="btn btn-primary btn-full" id="loginBtn">
                    <span id="loginText">Sign In</span>
                    <div id="loginLoading" class="loading" style="display: none;"></div>
                </button>
            </form>

            <div class="divider">
                <span>Don't have an account?</span>
            </div>

            <a href="/register" class="btn btn-outline btn-full">
                <svg class="icon" viewBox="0 0 24 24">
                    <path fill="currentColor" d="M15,14C12.33,14 7,15.33 7,18V20H23V18C23,15.33 17.67,14 15,14M6,10V7H4V10H1V12H4V15H6V12H9V10M15,12A4,4 0 0,0 19,8A4,4 0 0,0 15,4A4,4 0 0,0 11,8A4,4 0 0,0 15,12Z"/>
                </svg>
                Create New Account
            </a>
        </div>
    </div>

    <!-- Footer -->
    <footer class="site-footer footer--compact" role="contentinfo" aria-label="Site footer">
        <div class="container">
            <div class="footer-compact">
                <div class="footer-brand">
                    <svg class="icon-lg" viewBox="0 0 24 24" aria-hidden="true"><path fill="currentColor" d="M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2Z"/></svg>
                    <span class="brand-text">APNA Card</span>
                </div>
                <nav class="footer-links" aria-label="Footer">
                    <a href="/">Home</a>
                    <a href="/about">About</a>
                    <a href="/register">Register</a>
                </nav>
                <div class="footer-socials">
                    <a href="#" aria-label="Twitter"><svg class="icon" viewBox="0 0 24 24" aria-hidden="true"><path fill="currentColor" d="M22 5.8c-.8.3-1.6.6-2.4.7.9-.6 1.5-1.3 1.8-2.3-.9.5-1.8.9-2.8 1.1A4.1 4.1 0 0 0 12 8.9c0 .3 0 .6.1.9-3.4-.2-6.4-1.8-8.4-4.3-.4.7-.6 1.4-.6 2.2 0 1.4.7 2.7 1.8 3.5-.7 0-1.3-.2-1.9-.5 0 2 1.5 3.8 3.4 4.2-.4.1-.8.2-1.2.2-.3 0-.6 0-.9-.1.6 1.7 2.2 2.9 4.1 3a8.3 8.3 0 0 1-5.1 1.7H3a11.7 11.7 0 0 0 6.3 1.9c7.6 0 11.8-6.3 11.8-11.8v-.5c.8-.5 1.5-1.2 2-2z"/></svg></a>
                </div>
            </div>
            <div class="footer-bottom">
                <span>&copy; 2025 APNA Card — UET Lahore</span>
                <span>Secure sign-in • Premium, mobile-first</span>
            </div>
        </div>
    </footer>

    <script>
        // Login Form Handler
        document.getElementById('loginForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const loginBtn = document.getElementById('loginBtn');
            const loginText = document.getElementById('loginText');
            const loginLoading = document.getElementById('loginLoading');
            const alertContainer = document.getElementById('alert-container');
            
            // Show loading state
            loginBtn.disabled = true;
            loginText.style.display = 'none';
            loginLoading.style.display = 'inline-block';
            
            // Clear previous alerts
            alertContainer.innerHTML = '';
            
            const formData = new FormData(e.target);
            const loginData = {
                email: formData.get('email'),
                password: formData.get('password')
            };
            
            try {
                const response = await fetch('/api/auth/login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(loginData)
                });
                
                const result = await response.json();
                
                if (result.success) {
                    // Store token and user info
                    localStorage.setItem('token', result.data.token);
                    localStorage.setItem('user', JSON.stringify(result.data.user));
                    
                    // Show success message
                    showAlert('Login successful! Redirecting...', 'success');
                    
                    // Redirect based on role
                    setTimeout(() => {
                        window.location.href = result.data.redirectTo;
                    }, 1000);
                } else {
                    showAlert(result.message, 'danger');
                }
            } catch (error) {
                console.error('Login error:', error);
                showAlert('Login failed. Please try again.', 'danger');
            } finally {
                // Reset button state
                loginBtn.disabled = false;
                loginText.style.display = 'inline';
                loginLoading.style.display = 'none';
            }
        });
        
        // Alert function
        function showAlert(message, type) {
            const alertContainer = document.getElementById('alert-container');
            const alert = document.createElement('div');
            alert.className = `alert alert-${type}`;
            alert.textContent = message;
            alertContainer.appendChild(alert);
            
            // Auto remove after 5 seconds
            setTimeout(() => {
                alert.remove();
            }, 5000);
        }
        
        // Check if already logged in
        window.addEventListener('load', () => {
            const token = localStorage.getItem('token');
            const user = localStorage.getItem('user');
            
            if (token && user) {
                const userData = JSON.parse(user);
                const redirectTo = userData.role === 'admin' ? '/admin/dashboard' : '/student/dashboard';
                window.location.href = redirectTo;
            }
        });
    </script>
</body>
</html>
