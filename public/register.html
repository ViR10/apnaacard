<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
    <title>Register - APNA Card</title>

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Poppins:wght@400;500;600;700&display=swap"
        rel="stylesheet">

    <!-- Stylesheets -->
    <link rel="stylesheet" href="/css/style.css">

    <!-- App Icons & Manifest -->
    <link rel="icon" href="/favicon.svg" type="image/svg+xml">
    <link rel="manifest" href="/site.webmanifest">
    <meta name="application-name" content="APNA Card">
    <meta name="apple-mobile-web-app-title" content="APNA Card">

    <!-- SEO -->
    <meta name="description" content="Create your APNA Card account to manage and download your UET Lahore student ID card.">
    <link rel="canonical" href="https://apnacard.netlify.app/register">
    <meta name="robots" content="noindex, nofollow">
    <meta name="theme-color" content="#0e3e98">
    <meta property="og:title" content="Register — APNA Card">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://yourdomain.com/register">
    <meta name="twitter:card" content="summary">
</head>

<body class="auth-page">
    <a href="/" class="back-home">
        <svg class="icon" viewBox="0 0 24 24">
            <path fill="currentColor" d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" />
        </svg>
        Back to Home
    </a>

    <div class="register-container">
    <script src="/js/footer.js" defer></script>
        <div class="register-header">
            <div style="display: flex; align-items: center; justify-content: center; margin-bottom: 1rem;">
                <svg class="icon-lg" style="margin-right: 0.5rem;" viewBox="0 0 24 24" fill="white">
                    <path
                        d="M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M7.07,18.28C7.5,17.38 10.12,16.5 12,16.5C13.88,16.5 16.5,17.38 16.93,18.28C15.57,19.36 13.86,20 12,20C10.14,20 8.43,19.36 7.07,18.28M18.36,16.83C16.93,15.09 13.46,14.5 12,14.5C10.54,14.5 7.07,15.09 5.64,16.83C4.62,15.5 4,13.82 4,12C4,7.59 7.59,4 12,4C16.41,4 20,7.59 20,12C20,13.82 19.38,15.5 18.36,16.83M12,6C10.06,6 8.5,7.56 8.5,9.5C8.5,11.44 10.06,13 12,13C13.94,13 15.5,11.44 15.5,9.5C15.5,7.56 13.94,6 12,6M12,11A1.5,1.5 0 0,1 10.5,9.5A1.5,1.5 0 0,1 12,8A1.5,1.5 0 0,1 13.5,9.5A1.5,1.5 0 0,1 12,11Z" />
                </svg>
                APNA Card
            </div>
            <h1>Create Account</h1>
            <p>Join the UET student community</p>
        </div>

        <div class="register-body">
            <div id="alert-container"></div>

            <form id="registerForm">
                <div class="form-group">
                    <label class="form-label" for="fullName">Full Name</label>
                    <div style="position: relative;">
                        <svg class="icon form-icon" viewBox="0 0 24 24">
                            <path fill="currentColor"
                                d="M12,4A4,4 0 0,1 16,8A4,4 0 0,1 12,12A4,4 0 0,1 8,8A4,4 0 0,1 12,4M12,14C16.42,14 20,15.79 20,18V20H4V18C4,15.79 7.58,14 12,14Z" />
                        </svg>
                        <input type="text" id="fullName" name="fullName" class="form-control"
                            placeholder="Enter your full name" required>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label" for="department">Department</label>
                    <div style="position: relative;">
                        <svg class="icon form-icon" viewBox="0 0 24 24">
                            <path fill="currentColor"
                                d="M12,3L1,9L12,15L21,10.09V17H23V9M5,13.18V17.18L12,21L19,17.18V13.18L12,17L5,13.18Z" />
                        </svg>
                        <input type="text" id="department" name="department" class="form-control"
                            placeholder="e.g., Metallurgical and Materials Engineering, Electrical Engineering" required>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label" for="studentId">Student ID</label>
                    <div style="position: relative;">
                        <svg class="icon form-icon" viewBox="0 0 24 24">
                            <path fill="currentColor"
                                d="M2,3H22C23.05,3 24,3.95 24,5V19C24,20.05 23.05,21 22,21H2C0.95,21 0,20.05 0,19V5C0,3.95 0.95,3 2,3M14,6V7H22V6H14M14,8V9H21.5L22,9V8H14M14,10V11H21V10H14M8,13.91C6,13.91 2,15 2,17V18H14V17C14,15 10,13.91 8,13.91M8,6A3,3 0 0,0 5,9A3,3 0 0,0 8,12A3,3 0 0,0 11,9A3,3 0 0,0 8,6Z" />
                        </svg>
                        <input type="text" id="studentId" name="studentId" class="form-control" placeholder="2024-MM-14"
                            pattern="^\d{4}-[A-Za-z]{2,3}-\d{1,3}$" title="Format: YYYY-XX-### (e.g., 2024-MM-14, 2024-civ-14)" required>
                    </div>
                    <small style="color: #64748b; font-size: 0.75rem;">Format: YYYY-XX-### (e.g., 2024-MM-14, 2024-civ-14)</small>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label" for="studentEmail">Student Email</label>
                        <div style="position: relative;">
                            <svg class="icon form-icon" viewBox="0 0 24 24">
                                <path fill="currentColor"
                                    d="M20,8L12,13L4,8V6L12,11L20,6M20,4H4C2.89,4 2,4.89 2,6V18A2,2 0 0,0 4,20H20A2,2 0 0,0 22,18V6C22,4.89 21.1,4 20,4Z" />
                            </svg>
                            <input type="email" id="studentEmail" name="studentEmail" class="form-control"
                                placeholder="yourname@student.uet.edu.pk" pattern=".*@student\.uet\.edu\.pk$" required>
                        </div>
                        <small style="color: #64748b; font-size: 0.75rem;">Must end with @student.uet.edu.pk</small>
                    </div>

                    <div class="form-group">
                        <label class="form-label" for="personalEmail">Personal Email</label>
                        <div style="position: relative;">
                            <svg class="icon form-icon" viewBox="0 0 24 24">
                                <path fill="currentColor"
                                    d="M22,6C22,4.89 21.1,4 20,4H4A2,2 0 0,0 2,6V18A2,2 0 0,0 4,20H20A2,2 0 0,0 22,18V6M20,6L12,11L4,6H20M20,18H4V8L12,13L20,8V18Z" />
                            </svg>
                            <input type="email" id="personalEmail" name="personalEmail" class="form-control"
                                placeholder="your.personal@email.com" required>
                        </div>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label" for="password">Password</label>
                        <div style="position: relative;">
                            <svg class="icon form-icon" viewBox="0 0 24 24">
                                <path fill="currentColor"
                                    d="M12,17A2,2 0 0,0 14,15C14,13.89 13.1,13 12,13A2,2 0 0,0 10,15A2,2 0 0,0 12,17M18,8A2,2 0 0,1 20,10V20A2,2 0 0,1 18,22H6A2,2 0 0,1 4,20V10C4,8.89 4.9,8 6,8H7V6A5,5 0 0,1 12,1A5,5 0 0,1 17,6V8H18M12,3A3,3 0 0,0 9,6V8H15V6A3,3 0 0,0 12,3Z" />
                            </svg>
                            <input type="password" id="password" name="password" class="form-control" placeholder="Enter password"
                                minlength="6" required>
                        </div>
                        <div id="passwordStrength" class="password-strength"></div>
                    </div>

                    <div class="form-group">
                        <label class="form-label" for="confirmPassword">Confirm Password</label>
                        <div style="position: relative;">
                            <svg class="icon form-icon" viewBox="0 0 24 24">
                                <path fill="currentColor"
                                    d="M12,17A2,2 0 0,0 14,15C14,13.89 13.1,13 12,13A2,2 0 0,0 10,15A2,2 0 0,0 12,17M18,8A2,2 0 0,1 20,10V20A2,2 0 0,1 18,22H6A2,2 0 0,1 4,20V10C4,8.89 4.9,8 6,8H7V6A5,5 0 0,1 12,1A5,5 0 0,1 17,6V8H18M12,3A3,3 0 0,0 9,6V8H15V6A3,3 0 0,0 12,3Z" />
                            </svg>
                            <input type="password" id="confirmPassword" name="confirmPassword" class="form-control"
                                placeholder="Confirm password" required>
                        </div>
                    </div>
                </div>

                <button type="submit" class="btn btn-primary btn-full" id="registerBtn">
                    <span id="registerText">Create Account</span>
                    <div id="registerLoading" class="loading" style="display: none;"></div>
                </button>
            </form>

            <div style="text-align: center; margin-top: var(--spacing-lg); color: #64748b;">
                Already have an account?
                <a href="/login" style="color: var(--primary); text-decoration: none; font-weight: 500;">Sign in here</a>
            </div>
    </div>
    </div>

    <!-- Footer -->
    <footer class="site-footer footer--compact" role="contentinfo" aria-label="Site footer">
        <div class="container">
            <div class="footer-compact">
                <div class="footer-brand">
                    <svg class="icon-lg" viewBox="0 0 24 24" aria-hidden="true"><path fill="currentColor" d="M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2Z"/></svg>
                    <span class="brand-text">APNA Card</span>
                </div>
                <nav class="footer-links" aria-label="Footer">
                    <a href="/">Home</a>
                    <a href="/about">About</a>
                    <a href="/login">Login</a>
                </nav>
                <div class="footer-socials">
                    <a href="#" aria-label="Twitter"><svg class="icon" viewBox="0 0 24 24" aria-hidden="true"><path fill="currentColor" d="M22 5.8c-.8.3-1.6.6-2.4.7.9-.6 1.5-1.3 1.8-2.3-.9.5-1.8.9-2.8 1.1A4.1 4.1 0 0 0 12 8.9c0 .3 0 .6.1.9-3.4-.2-6.4-1.8-8.4-4.3-.4.7-.6 1.4-.6 2.2 0 1.4.7 2.7 1.8 3.5-.7 0-1.3-.2-1.9-.5 0 2 1.5 3.8 3.4 4.2-.4.1-.8.2-1.2.2-.3 0-.6 0-.9-.1.6 1.7 2.2 2.9 4.1 3a8.3 8.3 0 0 1-5.1 1.7H3a11.7 11.7 0 0 0 6.3 1.9c7.6 0 11.8-6.3 11.8-11.8v-.5c.8-.5 1.5-1.2 2-2z"/></svg></a>
                </div>
            </div>
            <div class="footer-bottom">
                <span>&copy; 2025 APNA Card — UET Lahore</span>
                <span>Create your account • Premium, mobile-first</span>
            </div>
        </div>
    </footer>

    <script>
        // Password strength checker
        document.getElementById('password').addEventListener('input', function () {
            const password = this.value;
            const strengthIndicator = document.getElementById('passwordStrength');

            let strength = 0;
            let feedback = '';

            if (password.length >= 6) strength++;
            if (password.match(/[a-z]/)) strength++;
            if (password.match(/[A-Z]/)) strength++;
            if (password.match(/[0-9]/)) strength++;
            if (password.match(/[^a-zA-Z0-9]/)) strength++;

            switch (strength) {
                case 0:
                case 1:
                    feedback = '<span class="strength-weak">Weak password</span>';
                    break;
                case 2:
                case 3:
                    feedback = '<span class="strength-medium">Medium password</span>';
                    break;
                case 4:
                case 5:
                    feedback = '<span class="strength-strong">Strong password</span>';
                    break;
            }

            strengthIndicator.innerHTML = feedback;
        });

        // Registration Form Handler
        document.getElementById('registerForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            const registerBtn = document.getElementById('registerBtn');
            const registerText = document.getElementById('registerText');
            const registerLoading = document.getElementById('registerLoading');
            const alertContainer = document.getElementById('alert-container');

            // Show loading state
            registerBtn.disabled = true;
            registerText.style.display = 'none';
            registerLoading.style.display = 'inline-block';

            // Clear previous alerts
            alertContainer.innerHTML = '';

            const formData = new FormData(e.target);
            const registrationData = {
                fullName: formData.get('fullName'),
                department: formData.get('department'),
                studentId: formData.get('studentId'),
                studentEmail: formData.get('studentEmail'),
                personalEmail: formData.get('personalEmail'),
                password: formData.get('password'),
                confirmPassword: formData.get('confirmPassword')
            };

            // Validate passwords match
            if (registrationData.password !== registrationData.confirmPassword) {
                showAlert('Passwords do not match', 'danger');
                resetButtonState();
                return;
            }

            try {
                const response = await fetch('/api/auth/register', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(registrationData)
                });

                const result = await response.json();

                if (result.success) {
                    showAlert('Registration successful! Redirecting to login...', 'success');

                    // Redirect to login after 2 seconds
                    setTimeout(() => {
                        window.location.href = '/login';
                    }, 2000);
                } else {
                    showAlert(result.message, 'danger');
                }
            } catch (error) {
                console.error('Registration error:', error);
                showAlert('Registration failed. Please try again.', 'danger');
            } finally {
                resetButtonState();
            }

            function resetButtonState() {
                registerBtn.disabled = false;
                registerText.style.display = 'inline';
                registerLoading.style.display = 'none';
            }
        });

        // Alert function
        function showAlert(message, type) {
            const alertContainer = document.getElementById('alert-container');
            const alert = document.createElement('div');
            alert.className = `alert alert-${type}`;
            alert.textContent = message;
            alertContainer.appendChild(alert);

            // Auto remove after 5 seconds
            setTimeout(() => {
                alert.remove();
            }, 5000);
        }

        // Student ID auto-formatting
        document.getElementById('studentId').addEventListener('input', function() {
            let value = this.value;
            
            // Convert department code to uppercase while preserving format
            const parts = value.split('-');
            if (parts.length === 3) {
                const year = parts[0];
                const dept = parts[1].toUpperCase(); // Convert to uppercase
                const number = parts[2];
                this.value = `${year}-${dept}-${number}`;
            }
        });

        // Check if already logged in
        window.addEventListener('load', () => {
            const token = localStorage.getItem('token');
            const user = localStorage.getItem('user');

            if (token && user) {
                const userData = JSON.parse(user);
                const redirectTo = userData.role === 'admin' ? '/admin/dashboard' : '/student/dashboard';
                window.location.href = redirectTo;
            }
        });
    </script>
</body>

</html>